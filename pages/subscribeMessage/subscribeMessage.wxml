<!--pages/subscribeMessage/subscribeMessage.wxml-->
<navBar title="订阅消息" />
<layout>
  <view class="subscribe-page">
    <view class="notice-text">
      微信消息需手动订阅才可提醒1次，为避免遗漏重要通知，你可以点击“接收 +1”增加提醒次数。
    </view>

    <block wx:if="{{loading}}">
      <view class="state-card">
        <text class="state-text">加载中...</text>
      </view>
    </block>

    <block wx:elif="{{errorMessage}}">
      <view class="state-card">
        <text class="state-text">{{errorMessage}}</text>
        <button class="primary-button" bindtap="loadSubscribeData">重新加载</button>
      </view>
    </block>

    <view class="template-container" wx:else>
      <view class="summary-card">
        <view class="summary-main">
          <view class="summary-info">
            <view class="summary-title-box">
              <text class="summary-title">全部消息提醒</text>
            </view>
            <text class="summary-desc">点击增加消息接收次数</text>
          </view>
          <button class="action-button" bindtap="handleSubscribeAll" disabled="{{isSubmitting}}">全部接收 +1</button>
        </view>
      </view>

      <block wx:if="{{templateItems.length}}">
        <view class="template-list">
          <view class="template-card" wx:for="{{templateItems}}" wx:key="templateId">
            <view class="template-main">
              <view class="template-info">
                <view class="template-title-box">
                  <text class="template-title">{{item.title}}</text>
                </view>
                <text class="template-desc">{{item.description}}</text>
              </view>
              <view class="template-right">
                <button
                  class="ghost-button"
                  data-template-id="{{item.templateId}}"
                  data-template-type="{{item.templateType}}"
                  bindtap="handleSubscribeSingle"
                  disabled="{{isSubmitting}}"
                >
                  接收 +1
                </button>
                <text class="quota-text">可提醒<text class="remainingQuota">{{item.remainingQuota}}</text>次</text>
              </view>
            </view>
          </view>
        </view>
      </block>

      <view class="state-card" wx:else>
        <text class="state-text">暂无订阅消息模板</text>
      </view>
    </view>
  </view>
</layout>