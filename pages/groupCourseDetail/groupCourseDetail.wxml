<!--pages/groupCourseDetail/groupCourseDetail.wxml-->
<wxs module="_filters">
module.exports = {
  getCoursePrice: function(course){
    switch (course.price_type) {
      case 1: // æ‰£è¯¾æ—¶
        return course.lesson_cost + 'è¯¾æ—¶'
      case 2: // é‡‘é¢å±•ç¤º
        return 'Â¥' + course.price_amount
      case 3: // å…è´¹
        return 'å…è´¹'
      default:
      return '--'
    }
  }
}
</wxs>
<ghostNav />
<!-- è¯¾ç¨‹å°é¢å›¾ç‰‡ -->
<view class="cover-section">
  <swiper
    class="swiper"
    wx:if="{{courseDetail.cover_images && courseDetail.cover_images.length}}"
    indicator-dots="true"
  >
    <block wx:for="{{courseDetail.cover_images}}" wx:key="*this">
      <swiper-item>
        <image
          class="cover-image" 
          src="{{item}}"
          mode="aspectFill"
        ></image>
      </swiper-item>
    </block>
  </swiper>
  <view wx:else class="cover-placeholder">
    <text class="placeholder-text">æš‚æ— å°é¢</text>
  </view>
</view>
<view class="container">
  <!-- è¯¾ç¨‹çŠ¶æ€æ ‡ç­¾ -->
  <view class="price-info">
    <view class="status-tag status_{{courseDetail.status}}">
      <block wx:if="{{courseDetail.status === 0}}">
        <text wx:if="{{courseDetail.is_published === 0}}">æœªå‘å¸ƒ</text>
      </block>
      <text wx:if="{{courseDetail.status === 1}}">æŠ¥åä¸­</text>
      <text wx:if="{{courseDetail.status === 2}}">å·²ç»“æŸ</text>
    </view>
    <view class="price">
      <text>{{_filters.getCoursePrice(courseDetail)}}</text>
    </view>
  </view>
  
  <view class="course-title">{{courseDetail.title}}</view>
  <!-- æ—¶é—´ä¿¡æ¯ -->
  <view class="time-info">
    <view class="time-item">
      <text>
        <text class="iconfont icon-shijianmoban time-icon"></text>
        <text class="time-text">{{courseDetail.showTime}}</text>
      </text>
      <text class="time-tag">{{courseDetail.duration}}åˆ†é’Ÿ</text>
    </view>
  </view>

  <!-- åœ°å€ä¿¡æ¯ -->
  <view wx:if="{{courseDetail.address}}" class="address-info" bindtap="onAddressTap">
    <text class="iconfont icon-locationfill address-icon"></text>
    <view class="address-details">
      <text class="address-name">{{courseDetail.address.name}}</text>
      <text class="address-desc">{{courseDetail.address.address}}</text>
    </view>
    <text class="iconfont icon-arrow-r"></text>
  </view>

  <!-- æŠ¥åä¿¡æ¯ -->
  <view class="registration-info">
    <view class="section-title">
      <text>å·²æŠ¥å</text>
      <text>{{courseDetail.current_participants}}/{{courseDetail.max_participants}} äºº</text>
    </view>
    <view class="registration-details">
      <view class="registration-item">
        <text class="registration-label">æŠ¥åèŒƒå›´ï¼š</text>
        <text class="registration-value">{{courseDetail.enrollment_scope === 1 ? 'ä»…å­¦å‘˜' : 'æ‰€æœ‰äºº'}}</text>
      </view>
      <view class="registration-item">
        <text class="registration-label">æˆå›¢äººæ•°ï¼š</text>
        <text class="registration-value">{{courseDetail.min_participants}} äºº</text>
      </view>
    </view>
  </view>

  <!-- æ•™ç»ƒä¿¡æ¯ -->
  <view class="coach-info">
    <image 
      class="coach-avatar" 
      src="{{courseDetail.coach.avatar_url || '/images/defaultAvatar.png'}}"
    ></image>
    <view class="coach-details">
      <text class="coach-name">{{courseDetail.coach.nickname}}</text>
      <text class="coach-desc">æ•™ç»ƒ</text>
    </view>
    <text class="iconfont icon-arrow-r"></text>
  </view>

  <!-- è¯¾ç¨‹è¯¦æƒ… -->
  <view wx:if="{{courseDetail.content}}" class="content-section">
    <view class="section-title">è¯¾ç¨‹è¯¦æƒ…</view>
    <view class="course-content">
      <text>{{courseDetail.content}}</text>
    </view>
    <view class="images-section">
      <image 
        wx:for="{{courseDetail.images}}" 
        wx:key="*this"
        class="detail-image"
        src="{{item}}"
        mode="widthFix"
        bindtap="previewImage"
        data-current="{{item}}"
        data-urls="{{courseDetail.images}}"
      ></image>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <view class="action-buttons">
      <!-- è¯¾ç¨‹æ‰€æœ‰è€…æ“ä½œæŒ‰é’® -->
      <view wx:if="{{isOwner}}" class="owner-actions">
        <!-- æœªå‘å¸ƒè¯¾ç¨‹ï¼šç¼–è¾‘ã€å‘å¸ƒ -->
        <view wx:if="{{!courseDetail.is_published}}" class="button-group">
          <button class="action-btn editable" bindtap="onEditCourse">
            ç¼–è¾‘è¯¾ç¨‹
          </button>
          <button class="action-btn publish" bindtap="onPublishCourse">
            å‘å¸ƒè¯¾ç¨‹
          </button>
        </view>
        
        <!-- å·²å‘å¸ƒè¯¾ç¨‹ï¼šç¼–è¾‘ -->
        <view wx:elif="{{courseDetail.status === 1}}" class="button-group">
          <button class="action-btn editable" bindtap="onEditCourse">
            ç¼–è¾‘è¯¾ç¨‹
          </button>
        </view>
      </view>
      
      <!-- éè¯¾ç¨‹æ‰€æœ‰è€…ï¼šæŠ¥åç›¸å…³æŒ‰é’® -->
      <view wx:else class="student-actions">
        <!-- æŠ¥å/å–æ¶ˆæŠ¥åæŒ‰é’® -->
        <button 
          wx:if="{{!isRegistered && courseDetail.registration_status === 1 && courseDetail.current_participants < courseDetail.max_participants}}"
          class="action-btn primary"
          bindtap="onRegisterTap"
        >
          ç«‹å³æŠ¥å
        </button>
        
        <button 
          wx:elif="{{isRegistered}}"
          class="action-btn secondary"
          bindtap="onUnregisterTap"
        >
          å–æ¶ˆæŠ¥å
        </button>
        
        <button 
          wx:else
          class="action-btn disabled"
          disabled
        >
          {{courseDetail.current_participants >= courseDetail.max_participants ? 'å·²æ»¡å‘˜' : 'æŠ¥åå·²ç»“æŸ'}}
        </button>

        <!-- åˆ†äº«æŒ‰é’® -->
        <button class="action-btn share" bindtap="onShareTap">
          <text class="share-icon">ğŸ“¤</text>
          åˆ†äº«
        </button>
      </view>
    </view>
  </view>
</view>
