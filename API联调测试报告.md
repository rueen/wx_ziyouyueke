# è‡ªç”±çº¦è¯¾å°ç¨‹åº - APIæ¥å£è”è°ƒæµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-06-05  
**æµ‹è¯•ç‰ˆæœ¬**: v1.0.0  
**åç«¯æœåŠ¡**: http://localhost:3000  

## æµ‹è¯•æ¦‚è¿°

æœ¬æ¬¡è”è°ƒæµ‹è¯•éªŒè¯äº†å¾®ä¿¡çº¦è¯¾ç³»ç»Ÿçš„åç«¯APIæ¥å£åŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¤è¯ã€ç”¨æˆ·ç®¡ç†ã€æ—¶é—´æ¨¡æ¿å’Œå¸ˆç”Ÿå…³ç³»ç­‰æ ¸å¿ƒæ¨¡å—ã€‚

## æµ‹è¯•ç¯å¢ƒ

- **åç«¯æœåŠ¡åœ°å€**: http://localhost:3000
- **APIç‰ˆæœ¬**: v1.0.0
- **æ•°æ®åº“**: MySQL (yueke)
- **å‰ç«¯**: å¾®ä¿¡å°ç¨‹åº

## æ¥å£æµ‹è¯•ç»“æœ

### âœ… åŸºç¡€æ¥å£

#### 1. å¥åº·æ£€æŸ¥
- **æ¥å£**: `GET /health`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æœåŠ¡è¿è¡Œæ­£å¸¸",
  "timestamp": "2025-06-05T11:18:11.226Z",
  "version": "1.0.0"
}
```

#### 2. ç®¡ç†ç«¯å¥åº·æ£€æŸ¥
- **æ¥å£**: `GET /api/admin/health`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç®¡ç†ç«¯æ¥å£æ­£å¸¸",
  "timestamp": "2025-06-05T11:37:10.911Z"
}
```

### âœ… è®¤è¯æ¨¡å—

#### 1. ç”¨æˆ·ç™»å½•
- **æ¥å£**: `POST /api/h5/auth/login`
- **çŠ¶æ€**: âœ… é€šè¿‡ï¼ˆéœ€è¦çœŸå®å¾®ä¿¡codeï¼‰
- **æµ‹è¯•ç”¨Token**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

#### 2. TokenéªŒè¯
- **æ¥å£**: `GET /api/h5/auth/verify`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "code": 200,
  "message": "Tokenæœ‰æ•ˆ",
  "data": {
    "user": {
      "id": 3,
      "openid": "oTpYE7jW96GEezc2qoJ7b3z2S5fY",
      "nickname": "å¾®ä¿¡ç”¨æˆ·",
      "avatar_url": "/images/defaultAvatar.png",
      "phone": null,
      "gender": null,
      "intro": null,
      "roles": {
        "isCoach": false,
        "isStudent": false
      }
    }
  }
}
```

#### 3. ç”¨æˆ·ç™»å‡º
- **æ¥å£**: `POST /api/h5/auth/logout`
- **çŠ¶æ€**: âœ… é€šè¿‡

### âœ… ç”¨æˆ·ä¿¡æ¯æ¨¡å—

#### 1. è·å–ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `GET /api/h5/user/profile`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **è¿”å›å­—æ®µ**: id, openid, nickname, avatar_url, phone, gender, intro, register_time, last_login_time, status, roles

#### 2. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `PUT /api/h5/user/profile`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **æµ‹è¯•æ•°æ®**:
```json
{
  "nickname": "æ¥å£æµ‹è¯•ç”¨æˆ·",
  "phone": "13800138000",
  "gender": 1,
  "intro": "è¿™æ˜¯é€šè¿‡APIæ¥å£æ›´æ–°çš„ç”¨æˆ·ä¿¡æ¯"
}
```

#### 3. è·å–ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
- **æ¥å£**: `GET /api/h5/user/stats`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "roles": {
      "isCoach": false,
      "isStudent": false
    },
    "coachStats": null,
    "studentStats": null
  }
}
```

### âœ… æ—¶é—´æ¨¡æ¿æ¨¡å—

#### 1. è·å–æ—¶é—´æ¨¡æ¿åˆ—è¡¨
- **æ¥å£**: `GET /api/h5/time-templates`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **åˆå§‹çŠ¶æ€**: ç©ºåˆ—è¡¨ `[]`

#### 2. åˆ›å»ºæ—¶é—´æ¨¡æ¿
- **æ¥å£**: `POST /api/h5/time-templates`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **æµ‹è¯•æ•°æ®**:
```json
{
  "min_advance_days": 1,
  "max_advance_days": 30,
  "time_slots": [
    {"startTime": "09:00", "endTime": "10:00"},
    {"startTime": "14:00", "endTime": "15:00"},
    {"startTime": "19:00", "endTime": "20:00"}
  ],
  "is_active": 1
}
```
- **è¿”å›ç»“æœ**: åˆ›å»ºæˆåŠŸï¼Œåˆ†é…ID: 2

#### 3. éªŒè¯åˆ›å»ºç»“æœ
- **æ¥å£**: `GET /api/h5/time-templates`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **è¿”å›æ•°æ®**: åŒ…å«åˆšåˆ›å»ºçš„æ¨¡æ¿

### âœ… å¸ˆç”Ÿå…³ç³»æ¨¡å—

#### 1. è·å–å¸ˆç”Ÿå…³ç³»åˆ—è¡¨
- **æ¥å£**: `GET /api/h5/relations`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **è¿”å›æ ¼å¼**: åˆ†é¡µæ•°æ®ï¼ŒåŒ…å«listå’Œpagination

#### 2. è·å–æˆ‘çš„æ•™ç»ƒåˆ—è¡¨
- **æ¥å£**: `GET /api/h5/relations/my-coaches`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **åˆå§‹çŠ¶æ€**: ç©ºåˆ—è¡¨ `[]`

#### 3. è·å–æˆ‘çš„å­¦å‘˜åˆ—è¡¨
- **æ¥å£**: `GET /api/h5/relations/my-students`
- **çŠ¶æ€**: âœ… é€šè¿‡
- **åˆå§‹çŠ¶æ€**: ç©ºåˆ—è¡¨ `[]`

## å‰ç«¯é›†æˆä¼˜åŒ–

### å·²å®Œæˆçš„APIé›†æˆ

1. **åˆ›å»ºäº†APIå·¥å…·ç±»** (`utils/api.js`)
   - ç»Ÿä¸€çš„è¯·æ±‚å°è£…
   - Tokenè‡ªåŠ¨ç®¡ç†
   - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
   - å®Œæ•´çš„æ¥å£æ–¹æ³•å°è£…

2. **ç™»å½•é¡µé¢é›†æˆ** (`pages/login/login.js`)
   - çœŸå®å¾®ä¿¡ç™»å½•APIè°ƒç”¨
   - Tokenä¿å­˜å’Œç”¨æˆ·ä¿¡æ¯ç¼“å­˜
   - é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

3. **ä¸ªäººä¿¡æ¯é¡µé¢é›†æˆ** (`pages/profile/profile.js`)
   - APIè·å–ç”¨æˆ·ä¿¡æ¯
   - çœŸå®ç™»å‡ºAPIè°ƒç”¨
   - æœ¬åœ°ç¼“å­˜åŒæ­¥

4. **æ—¶é—´æ¨¡æ¿é¡µé¢é›†æˆ** (`pages/timeTemplate/timeTemplate.js`)
   - è·å–æ—¶é—´æ¨¡æ¿æ•°æ®
   - åˆ›å»ºå’Œæ›´æ–°æ—¶é—´æ¨¡æ¿
   - æ•°æ®æ ¼å¼è½¬æ¢å’ŒéªŒè¯

### APIå·¥å…·ç±»ç‰¹æ€§

```javascript
// è‡ªåŠ¨Tokenç®¡ç†
const api = require('../../utils/api.js');

// è®¤è¯æ¨¡å—
await api.auth.login(params);
await api.auth.logout();
await api.auth.verifyToken();

// ç”¨æˆ·ä¿¡æ¯æ¨¡å—
await api.user.getProfile();
await api.user.updateProfile(userInfo);
await api.user.getStats();

// æ—¶é—´æ¨¡æ¿æ¨¡å—
await api.timeTemplate.getList();
await api.timeTemplate.create(template);
await api.timeTemplate.update(id, template);

// å¸ˆç”Ÿå…³ç³»æ¨¡å—
await api.relation.getList();
await api.relation.getMyCoaches();
await api.relation.getMyStudents();
```

## æµ‹è¯•å‘ç°çš„é—®é¢˜

### âš ï¸ éœ€è¦æ³¨æ„çš„ç‚¹

1. **å¾®ä¿¡ç™»å½•éªŒè¯**
   - éœ€è¦çœŸå®çš„å¾®ä¿¡codeæ‰èƒ½ç™»å½•æˆåŠŸ
   - æµ‹è¯•æ—¶ä½¿ç”¨äº†çœŸå®ç”¨æˆ·æä¾›çš„code: `0f17ZU000m5knU1LvT300nzkH407ZU0v`

2. **Tokenç®¡ç†**
   - Tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶
   - å‰ç«¯éœ€è¦å¤„ç†Tokenè¿‡æœŸçš„æƒ…å†µ
   - å·²åœ¨APIå·¥å…·ç±»ä¸­å®ç°è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ

3. **æ•°æ®æ ¼å¼**
   - æ—¶é—´æ¨¡æ¿çš„time_slotså­—æ®µå­˜å‚¨ä¸ºJSONå­—ç¬¦ä¸²
   - å‰ç«¯éœ€è¦è¿›è¡ŒJSONè§£æå’Œåºåˆ—åŒ–

## å¾…å¼€å‘æ¥å£

### ğŸš§ å¼€å‘ä¸­çš„æ¥å£

1. **è¯¾ç¨‹ç®¡ç†æ¨¡å—** (`/api/h5/courses`)
   - é¢„çº¦è¯¾ç¨‹
   - è·å–è¯¾ç¨‹åˆ—è¡¨
   - ç¡®è®¤/å–æ¶ˆè¯¾ç¨‹
   - å®Œæˆè¯¾ç¨‹

2. **æ•™ç»ƒç›¸å…³æ¨¡å—** (`/api/h5/coach`)
   - è·å–æ•™ç»ƒåˆ—è¡¨
   - è·å–æ•™ç»ƒè¯¦æƒ…
   - è·å–æ•™ç»ƒè¯¾ç¨‹å®‰æ’

3. **å­¦å‘˜ç›¸å…³æ¨¡å—** (`/api/h5/student`)
   - è·å–å­¦å‘˜é¢„çº¦è®°å½•
   - è·å–ç»‘å®šçš„æ•™ç»ƒåˆ—è¡¨

### ğŸ“‹ ç®¡ç†ç«¯åŠŸèƒ½

æ‰€æœ‰ç®¡ç†ç«¯æ¥å£ (`/api/admin/*`) ç›®å‰è¿”å›"åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­"çš„æç¤ºã€‚

## è”è°ƒå»ºè®®

### 1. æ¥ä¸‹æ¥çš„å¼€å‘é‡ç‚¹

1. **è¯¾ç¨‹ç®¡ç†æ¨¡å—**
   - è¿™æ˜¯æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
   - éœ€è¦å®Œå–„é¢„çº¦ã€ç¡®è®¤ã€å–æ¶ˆç­‰æµç¨‹

2. **å¸ˆç”Ÿå…³ç³»ç»‘å®š**
   - å®Œå–„ç»‘å®šæµç¨‹
   - æ·»åŠ é‚€è¯·ç åŠŸèƒ½

3. **æ•°æ®ç»Ÿè®¡**
   - å®Œå–„ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
   - æ·»åŠ è¯¾ç¨‹ç»Ÿè®¡æ•°æ®

### 2. å‰ç«¯ä¼˜åŒ–å»ºè®®

1. **é”™è¯¯å¤„ç†**
   - æ·»åŠ æ›´å‹å¥½çš„é”™è¯¯æç¤º
   - å®ç°æ–­ç½‘é‡è¯•æœºåˆ¶

2. **æ•°æ®åŒæ­¥**
   - å®ç°æœ¬åœ°ç¼“å­˜ä¸æœåŠ¡ç«¯æ•°æ®åŒæ­¥
   - æ·»åŠ ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½

3. **ç”¨æˆ·ä½“éªŒ**
   - æ·»åŠ åŠ è½½çŠ¶æ€æç¤º
   - ä¼˜åŒ–é¡µé¢åˆ‡æ¢åŠ¨ç”»

## æµ‹è¯•ç»“è®º

âœ… **æ•´ä½“è¯„ä¼°**: æ ¸å¿ƒè®¤è¯å’ŒåŸºç¡€åŠŸèƒ½æ¥å£è¿è¡Œè‰¯å¥½  
âœ… **APIè®¾è®¡**: æ¥å£è®¾è®¡åˆç†ï¼Œå“åº”æ ¼å¼ç»Ÿä¸€  
âœ… **å‰ç«¯é›†æˆ**: APIå·¥å…·ç±»å°è£…å®Œå–„ï¼Œä¾¿äºä½¿ç”¨  
âš ï¸ **å¾…å®Œå–„**: è¯¾ç¨‹ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½éœ€è¦ç»§ç»­å¼€å‘  

**æ€»ä½“å»ºè®®**: å½“å‰å·²å®ç°çš„æ¥å£åŠŸèƒ½ç¨³å®šï¼Œå¯ä»¥ç»§ç»­å¼€å‘è¯¾ç¨‹ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ã€‚å‰ç«¯APIé›†æˆå·²ç»å®ŒæˆåŸºç¡€æ¶æ„ï¼Œåç»­åªéœ€è¦æŒ‰ç…§ç›¸åŒæ¨¡å¼é›†æˆæ–°æ¥å£å³å¯ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-06-05 19:40  
**æµ‹è¯•å·¥ç¨‹å¸ˆ**: AI Assistant  
**é¡¹ç›®çŠ¶æ€**: è¿›è¡Œä¸­ï¼ŒåŸºç¡€åŠŸèƒ½å·²å®Œæˆï¼Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ä¸­ 