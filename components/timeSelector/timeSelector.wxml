<!--components/timeSelector/timeSelector.wxml-->
<view class="template-status" wx:if="{{timeTemplate && !timeTemplate.is_active}}">
  <text class="status-text">⚠️ 教练已关闭预约</text>
</view>
<view class="time-selector" wx:else>
  <!-- 日期选择器 -->
  <view class="date-selector">
    <scroll-view class="date-scroll" scroll-x="true" scroll-left="{{scrollLeft}}" show-scrollbar="{{false}}">
      <view class="date-list">
        <view 
          class="date-item {{item.date === currentDate ? 'active' : ''}} {{item.status === 'full' ? 'full' : ''}}"
          wx:for="{{dateList}}" 
          wx:key="date"
          data-date="{{item.date}}"
          bindtap="onSelectDate"
        >
          <view class="date-weekday">{{item.weekDay}}</view>
          <view class="date-monthday">{{item.monthDay}}</view>
          <view class="date-status">
            <text wx:if="{{item.status === 'available'}}">可约</text>
            <text wx:if="{{item.status === 'full'}}">已满</text>
          </view>
          <view wx:if="{{item.isToday}}" class="today-indicator">今天</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 时间段列表 -->
  <view class="time-slots-container">
    <!-- 加载状态 -->
    <view wx:if="{{isLoading}}" class="loading-container">
      <view class="loading-text">加载中...</view>
    </view>

    <!-- 时间段列表 -->
    <view wx:else class="time-slots">
      <view wx:if="{{timeSlots.length === 0 || !dateList.length}}" class="empty-state">
        <text>暂无时间安排</text>
      </view>
      
      <view wx:else>
        <view 
          class="time-slot {{slot.status}} {{mode === 'select' && (slot.status === 'free' || slot.status === 'booked') && !slot.isExpired ? 'selectable' : ''}} {{slot.id === selectedTimeSlot.id ? 'selected' : ''}}"
          wx:for="{{timeSlots}}" 
          wx:for-item="slot"
          wx:key="id"
          data-slot="{{slot}}"
          bindtap="onTimeSlotTap"
        >
          <view class="time-slot-time">
            <text>{{slot.startTime}} - {{slot.endTime}}</text>
            <!-- 名额统计 -->
            <text class="quota-statistics" wx:if="{{mode === 'view' && showBookingDetails}}">{{slot.bookedCount}}/{{slot.maxAdvanceNums}} 已预约</text>
          </view>
          
          <!-- 查看模式：显示课程列表 -->
          <view wx:if="{{mode === 'view' && showBookingDetails}}" class="time-slot-content">
            <!-- 课程列表 -->
            <view wx:if="{{slot.courses.length > 0}}" class="courses-list">
              <view 
                class="course-item" 
                wx:for="{{slot.courses}}" 
                wx:for-item="course" 
                wx:key="id"
                data-course="{{course}}"
                bindtap="onCourseTap"
              >
                <view class="student-info">
                  <text class="student-name">{{course.studentName}}</text>
                  <view class="status-badge status-{{course.booking_status}}">
                    <text class="status-text">{{course.booking_status === 'pending' ? (
                      course.isCreatedByCurrentUser ? (
                        userRole === 'coach' ? '待学员确认' : '待教练确认'
                      ) : '待确认'
                    ) : 
                      course.booking_status === 'confirmed' ? '已确认' : 
                      course.booking_status === 'completed' ? '已完成' : 
                      course.booking_status === 'cancelled' ? '已取消' : '未知状态'}}</text>
                  </view>
                </view>
                <view class="location-info">
                  <text class="iconfont icon-locationfill"></text>
                  <text>{{course.location}}</text>
                </view>
              </view>
            </view>
            
            <!-- 无课程时的提示 -->
            <view wx:else class="no-courses">
              <text class="no-courses-text">暂无预约</text>
            </view>
          </view>
          
          <!-- 选择模式：显示名额统计 -->
          <view wx:elif="{{mode === 'select'}}" class="time-slot-content">
            <!-- 过期状态 -->
            <view wx:if="{{slot.status === 'expired'}}" class="quota-info">
              <text class="expired-text">已过期</text>
            </view>
            <view class="quota-info" wx:else>
              <text class="quota-text">{{slot.bookedCount}}/{{slot.maxAdvanceNums}}</text>
              <text wx:if="{{slot.remainingCount > 0}}" class="remaining-text">(剩余{{slot.remainingCount}}个)</text>
              <text wx:else class="full-text">(已满员)</text>
            </view>
            
            <!-- 选择提示 -->
            <view wx:if="{{slot.status === 'free' || slot.status === 'booked'}}" class="select-hint-container">
              <view wx:if="{{slot.id !== selectedTimeSlot.id}}" class="select-hint">点击选择</view>
              <text class="iconfont icon-selected" wx:if="{{slot.id === selectedTimeSlot.id}}"></text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 